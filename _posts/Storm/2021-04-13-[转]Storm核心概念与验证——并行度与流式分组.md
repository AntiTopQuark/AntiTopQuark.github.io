---
layout: post
cid: 50
title: [转]Storm核心概念与验证——并行度与流式分组
slug: 50
date: 2021/04/13 17:45:07
updated: 2021/04/13 17:45:07
status: publish
author: AntiTopQuark
categories: 
  - Storm
  - 大数据
tags: 
  - 实例
  - 方法
  - 进程
  - task
  - worker
  - storm
  - bolt
  - spout
  - executor
  - topology
customSummary: 
noThumbInfoStyle: default
outdatedNotice: no
reprint: standard
thumb: 
thumbChoice: default
thumbDesc: 
thumbSmall: 
thumbStyle: default
---



<! --index-menu -->
# 原贴地址：
[https://blog.51cto.com/xpleaf/2103102][1]
# Storm核心概念之并行度
![59228-qlxwdw7wuj.png](http://www.sukidesu.top/usr/uploads/2020/03/144190647.png)
**Work** 
1个worker进程执行的是1个topology的子集。注：不会出现1个worker为多个topology服务
1个worker进程会启动1个或多个executor线程来执行1个topology的(spout或bolt)。
因此，1个运行中的topology就是由集群中多台(可能是一台)物理机上的一个或者多个worker进程组成的。 
**Executor** 
executor是worker进程启动的一个单独线程。 
每个executor只会运行1个topology的1个或者多个(spout或bolt)task
（注：task可以是1个或多个，storm默认是1个(spout或bolt)，只生成1个task，executor线程会在每次循环里顺序调用所有task实例）。

**Task** 
task是最终运行spout或bolt中代码的执行单元（注：1个task即为spout或bolt的1个实例，executor线程在执行期间会调用该task的nextTuple或execute方法）。
topology启动后，1个(spout或bolt)的task数目是固定不变的，但该(spout或bolt)使用的executor线程数可以动态调整（例如：1个executor线程可以执行该(spout或bolt)的1个或多个task实例）。这意味着，对于1个(spout或bolt)存在这样的条件：#threads<=#tasks（即：线程数小于等于task数目）。默认情况下task的数目等于executor线程数目，即1个executor线程只运行1个task。 
默认情况下，一个supervisor节点最多可以启动4个worker进程，每一个topology默认占用一个worker进程，每个spout或者bolt会占用1个executor，每个executor启动1个task。

**那么到底并行度设置多少合适呢，理论参考值：**

- 单spout每秒大概可以发送500个tuple
- 单bolt每秒大概可以接收2000个tuple
- 单acker每秒大概可以接收6000个tuple
根据上面的指标可以根据当前业务的数据量对并行度进行动态调整。
**Storm核心概念之流式分组（storm grouping）**
假设storm集群现在有三个节点。一个作为nimbus，两个作为supervisor。到这里先介绍一下storm逻辑上有两个component，一个是Spout，另一个是Bolt。stream由Spout发出，在不同的Bolt之间进行处理，在其中传递的是storm的基本处理单位：Tuple。由Spout发出一个一个Tuple，然后Bolt接收Tuple进行各种各样的处理。这一整个过程构成一个DAG(有向无环图)。在storm里面叫做Topology。

![70196-lyh4wy8y1rk.png](http://www.sukidesu.top/usr/uploads/2020/03/1102088269.png)
上图中spout的处理逻辑是将一句话发出给下一个Bolt，然后下一个Bolt做句子的单词分割，下一个做计数，最后的Bolt做汇总显示。这里可以有多个Bolt或者Spout进行并行处理。

那么这里有一个问题，数据是如何从spout到bolt中的呢，如果bolt是多个情况呢？这就是我们所说的流分组，也就是在Spout与Bolt、Bolt与Bolt之间传递Tuple的方式，我们称之为流分组storm grouping。

  [1]: https://blog.51cto.com/xpleaf/2103102

